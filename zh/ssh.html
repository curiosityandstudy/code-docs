<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SSH | Code Docs</title>
    <meta name="description" content="让你的生活变得简单">
    
    
    <link rel="preload" href="/code-docs/assets/css/0.styles.51cd10b9.css" as="style"><link rel="preload" href="/code-docs/assets/js/app.542ab68e.js" as="script"><link rel="preload" href="/code-docs/assets/js/2.f5983905.js" as="script"><link rel="preload" href="/code-docs/assets/js/53.63366141.js" as="script"><link rel="prefetch" href="/code-docs/assets/js/10.826806a3.js"><link rel="prefetch" href="/code-docs/assets/js/11.5bd8f4ea.js"><link rel="prefetch" href="/code-docs/assets/js/12.808f4930.js"><link rel="prefetch" href="/code-docs/assets/js/13.8b1a6c33.js"><link rel="prefetch" href="/code-docs/assets/js/14.6a60230f.js"><link rel="prefetch" href="/code-docs/assets/js/15.3434ef20.js"><link rel="prefetch" href="/code-docs/assets/js/16.09145d2b.js"><link rel="prefetch" href="/code-docs/assets/js/17.5c5f17ac.js"><link rel="prefetch" href="/code-docs/assets/js/18.1744b663.js"><link rel="prefetch" href="/code-docs/assets/js/19.d7c28ab4.js"><link rel="prefetch" href="/code-docs/assets/js/20.dd5a7219.js"><link rel="prefetch" href="/code-docs/assets/js/21.b16d4a2d.js"><link rel="prefetch" href="/code-docs/assets/js/22.e653068a.js"><link rel="prefetch" href="/code-docs/assets/js/23.d7483c6f.js"><link rel="prefetch" href="/code-docs/assets/js/24.f8e9a289.js"><link rel="prefetch" href="/code-docs/assets/js/25.54361724.js"><link rel="prefetch" href="/code-docs/assets/js/26.cf92e1f0.js"><link rel="prefetch" href="/code-docs/assets/js/27.c1f2caf6.js"><link rel="prefetch" href="/code-docs/assets/js/28.a5888582.js"><link rel="prefetch" href="/code-docs/assets/js/29.70a79293.js"><link rel="prefetch" href="/code-docs/assets/js/3.9c608930.js"><link rel="prefetch" href="/code-docs/assets/js/30.efe5954d.js"><link rel="prefetch" href="/code-docs/assets/js/31.0b9fcfd8.js"><link rel="prefetch" href="/code-docs/assets/js/32.c729ad70.js"><link rel="prefetch" href="/code-docs/assets/js/33.89a78bfe.js"><link rel="prefetch" href="/code-docs/assets/js/34.f809aeea.js"><link rel="prefetch" href="/code-docs/assets/js/35.ffd8e842.js"><link rel="prefetch" href="/code-docs/assets/js/36.da0f4a56.js"><link rel="prefetch" href="/code-docs/assets/js/37.6e6209b1.js"><link rel="prefetch" href="/code-docs/assets/js/38.b0879f1e.js"><link rel="prefetch" href="/code-docs/assets/js/39.de00b6a8.js"><link rel="prefetch" href="/code-docs/assets/js/4.c9aa43f1.js"><link rel="prefetch" href="/code-docs/assets/js/40.127db237.js"><link rel="prefetch" href="/code-docs/assets/js/41.28630eb5.js"><link rel="prefetch" href="/code-docs/assets/js/42.ff97c0f6.js"><link rel="prefetch" href="/code-docs/assets/js/43.508f025c.js"><link rel="prefetch" href="/code-docs/assets/js/44.161c7793.js"><link rel="prefetch" href="/code-docs/assets/js/45.2930795e.js"><link rel="prefetch" href="/code-docs/assets/js/46.02191808.js"><link rel="prefetch" href="/code-docs/assets/js/47.18fd2ec3.js"><link rel="prefetch" href="/code-docs/assets/js/48.a56cd9ba.js"><link rel="prefetch" href="/code-docs/assets/js/49.a38ccd55.js"><link rel="prefetch" href="/code-docs/assets/js/5.ddb89a4c.js"><link rel="prefetch" href="/code-docs/assets/js/50.c4b1b250.js"><link rel="prefetch" href="/code-docs/assets/js/51.60b9d287.js"><link rel="prefetch" href="/code-docs/assets/js/52.a80280aa.js"><link rel="prefetch" href="/code-docs/assets/js/54.0c6a0b7e.js"><link rel="prefetch" href="/code-docs/assets/js/55.772e5320.js"><link rel="prefetch" href="/code-docs/assets/js/56.fb3a6ebe.js"><link rel="prefetch" href="/code-docs/assets/js/6.8eaceb3e.js"><link rel="prefetch" href="/code-docs/assets/js/7.8b8c606a.js"><link rel="prefetch" href="/code-docs/assets/js/8.7d08e1e1.js"><link rel="prefetch" href="/code-docs/assets/js/9.24b95cca.js">
    <link rel="stylesheet" href="/code-docs/assets/css/0.styles.51cd10b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/code-docs/zh/" class="home-link router-link-active"><!----> <span class="site-name">Code Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SSH</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/code-docs/zh/ssh.html#基本" class="sidebar-link">基本</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/code-docs/zh/ssh.html#高级" class="sidebar-link">高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code-docs/zh/ssh.html#基本配置" class="sidebar-link">基本配置</a></li><li class="sidebar-sub-header"><a href="/code-docs/zh/ssh.html#跳板加速" class="sidebar-link">跳板加速</a></li><li class="sidebar-sub-header"><a href="/code-docs/zh/ssh.html#执行命令" class="sidebar-link">执行命令</a></li><li class="sidebar-sub-header"><a href="/code-docs/zh/ssh.html#端口转发" class="sidebar-link">端口转发</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ssh"><a href="#ssh" aria-hidden="true" class="header-anchor">#</a> SSH</h1> <p>SSH是一种网络协议，用于计算机之间的加密登录。</p> <h2 id="基本"><a href="#基本" aria-hidden="true" class="header-anchor">#</a> 基本</h2> <ul><li><code>ssh</code> 默认端口号是22, 如果远程服务器修改了端口号则命令后面加参数 <code>-p &lt;port&gt;</code>。</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ssh</span> root@192.168.1.121

<span class="token function">ssh</span> -i dev.pem ec2-user@<span class="token operator">&lt;</span>ip-address<span class="token operator">&gt;</span> <span class="token comment"># 使用pem文件方式登录</span>
</code></pre></div><ul><li>生成公钥私钥</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>ssh-keygen -t rsa
</code></pre></div><p>文件路径在 <code>~/.ssh</code>。私钥文件是 <code>id_rsa</code>, 公钥文件是 <code>id_rsa.pub</code>。公钥内容需加入远程服务器文件 <code>~/.ssh/authorized_keys</code> 里面方能连接。</p> <h2 id="高级"><a href="#高级" aria-hidden="true" class="header-anchor">#</a> 高级</h2> <p>对于登录频率非常高的服务器有必要修改下 <code>~/.ssh/config</code> 文件, 避免每次都要通过命令 <code>ssh root@&lt;ip-address&gt;</code> 来登录。</p> <h3 id="基本配置"><a href="#基本配置" aria-hidden="true" class="header-anchor">#</a> 基本配置</h3> <p>配置 <code>~/.ssh/config</code> 文件, 可以使用命令 <code>ssh codedocs-test</code> 和 <code>ssh codedocs-staging</code> 登录服务器。可读性高, 而且有智能提示。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># 最简单的配置</span>
Host codedocs<span class="token punctuation">-</span>test
    HostName test.codedocs.io
    User ec2<span class="token punctuation">-</span>user

<span class="token comment"># 带pem文件和自定义PORT</span>
Host codedocs<span class="token punctuation">-</span>staging
    HostName staging.codedocs.io
    User ec2<span class="token punctuation">-</span>user
    Port 2200
    IdentityFile ~/pems/codedocs<span class="token punctuation">-</span>staging.pem
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p> <p>不修改 <code>~/.ssh/config</code> 也可以直接指定一个config文件。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ssh</span> -F ./ssh-config codedocs-staging
</code></pre></div></div> <h3 id="跳板加速"><a href="#跳板加速" aria-hidden="true" class="header-anchor">#</a> 跳板加速</h3> <p>从中国直接ssh美国的服务器很慢, 以下配置通过首尔服务器做跳板可以达到加速访问的效果。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>Host codedocs<span class="token punctuation">-</span>dev
    HostName dev.codedocs.io
    User ec2<span class="token punctuation">-</span>user
    ProxyCommand ssh codedocs<span class="token punctuation">-</span>us<span class="token punctuation">-</span>vpn nc %h %p

Host codedocs<span class="token punctuation">-</span>us<span class="token punctuation">-</span>vpn
    HostName us.vpn.codedocs.io
    User ubuntu
    ProxyCommand ssh codedocs<span class="token punctuation">-</span>seoul<span class="token punctuation">-</span>vpn nc %h %p

Host codedocs<span class="token punctuation">-</span>seoul<span class="token punctuation">-</span>vpn
    HostName seoul.vpn.codedocs.io
    User ubuntu
</code></pre></div><p><code>ssh codedocs-us-vpn</code> 命令会先连到 <code>codedocs-seoul-vpn</code> 再连到 <code>codedocs-us-vpn</code> 服务器。</p> <p><code>ssh codedocs-dev</code> 命令则是通过 <code>codedocs-seoul-vpn</code> 和 <code>codedocs-us-vpn</code> 最后连到 <code>codedocs-dev</code> 服务器。</p> <h3 id="执行命令"><a href="#执行命令" aria-hidden="true" class="header-anchor">#</a> 执行命令</h3> <ul><li>登录 <code>codedocs-dev</code> 后自动进入 <code>/var/www</code> 目录并列出目录。</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ssh</span> codedocs-dev -t <span class="token string">&quot;cd /var/www; ls; bash&quot;</span>
</code></pre></div><ul><li>以下代码为ssh执行代码块的示例。代码保存为 <code>tmp.sh</code> 文件执行 <code>ssh tmp.sh &lt;env&gt;</code>。</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>env<span class="token operator">=</span><span class="token variable">$1</span>

scripts<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
    cd /tmp
    mv bash-<span class="token variable">$env</span>.config bash.config

    bash update-env.sh

    rm -f /tmp/update-env.sh
    rm -f /tmp/bash.config
EOF</span>
<span class="token variable">)</span></span>

<span class="token function">ssh</span> codedocs-dev -t <span class="token string">&quot;sudo sh -c '<span class="token variable">$scripts</span>'&quot;</span>
</code></pre></div><h3 id="端口转发"><a href="#端口转发" aria-hidden="true" class="header-anchor">#</a> 端口转发</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ssh</span> -L <span class="token punctuation">[</span>listening port<span class="token punctuation">]</span>:<span class="token punctuation">[</span>REMOTE_MYSQL_HOST<span class="token punctuation">]</span>:<span class="token punctuation">[</span>REMOTE_MYSQL_PORT<span class="token punctuation">]</span> <span class="token punctuation">[</span>SSH_USER<span class="token punctuation">]</span>@<span class="token punctuation">[</span>SSH_HOST<span class="token punctuation">]</span>
</code></pre></div><p><strong>场景描述</strong></p> <p><code>dev.codedocs.io</code> 服务器出于安全考虑只开放了 <code>80/443/22</code> 端口。<code>dev.codedocs.io</code> 服务器可以访问RDS <code>db.codedocs.io</code>。本地电脑无法直接访问 <code>db.codedocs.io</code>。本地电脑可以ssh上 <code>dev.codedocs.io</code>。</p> <p>本地电脑希望能通过本地 <code>127.0.0.1:3308</code> 连接上远程数据库。</p> <ol><li>如下配置</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code>Host codedocs<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>db<span class="token punctuation">-</span>tunnel
    HostName dev.codedocs.io
    User ec2<span class="token punctuation">-</span>user
    LocalForward 3308 db.codedocs.io<span class="token punctuation">:</span><span class="token number">3306</span>
</code></pre></div><ol start="2"><li>运行命令</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ssh</span> -f -N codedocs-dev-db-tunnel

<span class="token comment"># -f puts ssh in background</span>
<span class="token comment"># -N makes it not execute a remote command</span>
</code></pre></div><ol start="3"><li>连接数据库</li></ol> <p>1, 2 两步等价于 <code>ssh -f -N -L 3308:db.codedocs.io:3306 ec2-user@dev.codedocs.io</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysql -h 127.0.0.1  -uroot -p123456 -Ddemo_db -A --port<span class="token operator">=</span>3308

<span class="token comment"># -A no-auto-rehash 禁用智能提示, 加快敲命令速度</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次编辑时间: </span> <span class="time">9/15/2018, 9:46:37 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/code-docs/assets/js/app.542ab68e.js" defer></script><script src="/code-docs/assets/js/2.f5983905.js" defer></script><script src="/code-docs/assets/js/53.63366141.js" defer></script>
  </body>
</html>
